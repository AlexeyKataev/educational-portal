@{
    ViewData["Title"] = "Домашняя страница";
	Layout = "_Layout";
}

<div>
	<div class="container">
		@if (User.IsInRole("user"))
		{
			<div class="alert alert-info w-100" role="alert">
				<p class="mb-0">Ваша учётная запись в данный момент неактивна.</p>
			</div>
		}
		else 
		{
			<div class="mt-5">
				<div class="mt-0">
					<div class="me-round">
						@{string meChars = $"{ViewBag.me.SecondName[0]}{ViewBag.me.FirstName[0]}";}
						<p class="me-round-chars">@meChars</p>
					</div>
				</div>
				<div class="me-index">
					<p class="me-index-name">@ViewBag.me.SecondName @ViewBag.me.FirstName</p>
					<p class="me-index-aboutme">@ViewBag.aboutMe</p>
				</div>
			</div>
		}
		@if (User.IsInRole("teacher"))
		{
			<div class="service-nav-panel">
				<a asp-area="" asp-controller="Work" asp-action="AddTask" class="service-buttom">
					<div class="service-buttom-icon">
						<i class="bi bi-plus-square-fill"></i>
					</div>
					<div class="service-buttom-name">Создать задание</div>
				</a>
				<a asp-area="" asp-controller="Work" asp-action="Tasks" class="service-buttom">
					<div class="service-buttom-icon">
						<i class="bi bi-list-task"></i>
					</div>
					<div class="service-buttom-name">Задания</div>
				</a>
				<a asp-area="" asp-controller="Work" asp-action="Attachments" class="service-buttom">
					<div class="service-buttom-icon">
						<i class="bi bi-file-earmark-fill"></i>
					</div>
					<div class="service-buttom-name">Файлы</div>
				</a>
				<a asp-area="" asp-controller="Student" asp-action="Students" class="service-buttom">
					<div class="service-buttom-icon">
						<i class="bi bi-people-fill"></i>
					</div>
					<div class="service-buttom-name">Студенты</div>
				</a>
			</div>
		}
		else if (User.IsInRole("student"))
		{
			<div class="service-nav-panel">
				<a asp-area="" asp-controller="Work" asp-action="Tasks" class="service-buttom">
					<div class="service-buttom-icon">
						<i class="bi bi-list-task"></i>
					</div>
					<div class="service-buttom-name">Задания</div>
				</a>
				<a asp-area="" asp-controller="StudyGroup" asp-action="MyStudyGroup" class="service-buttom">
					<div class="service-buttom-icon">
						<i class="bi bi-people-fill"></i>
					</div>
					<div class="service-buttom-name">Моя группа</div>
				</a>
			</div>
			<div>
				<h1 class="display-4 mt-4 mb-5 pt-5 pb-5">Задания</h1>
				@if (ViewBag.myWorks.Count > 0)
				{
					@foreach (var work in ViewBag.myWorks)
					{
						<div class="card mb-2">
						<div class="card-body overflow-auto">
							<h6 class="card-title">
								@if (work.DateAdded.ToString("yyyy-MM-dd") == DateTime.Today.ToString("yyyy-MM-dd"))
								{
									<span class="badge badge-success mr-2">Сегодня, @work.DateAdded.ToString("HH:mm")</span>
								}
								else 
								{
									<span class="badge badge-light mr-2" style="text-transform: capitalize;">@work.DateAdded.ToString(@"dddd, dd MMMM \'yy HH:mm")</span>
								}
								@foreach (var subject in ViewBag.subjects)
								{
									@if (subject.Id == work.SubjectId)
									{
										<span class="badge badge-light mr-2">@subject.Name</span>
									}
								}
								<p class="mt-4 pb-2">@work.Description</p>
							</h6>
							<table class="table table-sm table-hover mb-0">
								<thead>
									<tr class="text-align-top">
										<td scope="col">Дата сдачи</td>
										<td scope="col">Попытки</td>
										<td scope="col">Вид работы</td>
										<td scope="col">Вложения</td>
									</tr>
								</thead>
								<tbody>
									<tr>
										@if (work.DateDeparture == new DateTime(0001, 01, 01, 01, 01, 01))
										{
											<td>Бессрочно</td>
										}
										else 
										{
											<td>@work.DateDeparture</td>
										}
										<td>@work.CountAttempts</td>
										@foreach (var typeWorks in ViewBag.typesWorks)
										{
											@if (typeWorks.Id == work.TypeWorksId)
											{
												<td>@typeWorks.Name</td>
											}
										}
										<td>
											@foreach (var fileWork in ViewBag.fileWork)
											{
												@if (fileWork.WorkId == work.Id)
												{
													@foreach (var file in ViewBag.files)
													{
														@if (file.Id == fileWork.FileId)
														{
															@foreach (var file2 in ViewBag.files)
															{
																<nav class="nav flex-column">
																	@if (file2.Id == fileWork.FileId)
																	{
																		<a href="#" class="nav-link p-0">@file.Pseudonym</a>
																	}
																</nav>
															}
															break;
														}
													}
												}
											}
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					}
				}
				else
				{
					<div class="alert alert-info w-100" role="alert">
						<p class="mb-0">Для Вашей подгруппы нет заданий от преподавателей.</p>
					</div>
				}
			</div>
		}
	</div>
</div>


